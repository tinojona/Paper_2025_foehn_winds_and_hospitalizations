---
title: "descriptive statisitcs: figures and tables"
author: "Tino Schneidewind"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r data, echo=FALSE, warning=FALSE, message=FALSE}
## Preamble ####
rm(list=ls())

# packages
library(dplyr); library(tidyr); library(plotly);library(zoo); library(viridis); library(knitr)

data = read.csv("C:/Users/tinos/Documents/Master - Climate Science/3 - Master Thesis/data/MedStat_aggregated/centroid_aggregated/hosp_buffer_8000.csv") # data

data$date = as.Date(data$date); data$station <- as.factor(data$station)

# index to include only stratum that have hosp counts
data$stratum_dow = as.factor(data$stratum_dow); data$stratum = as.factor(data$stratum)
ind_dow = tapply(data$all, data$stratum_dow, sum); ind = tapply(data$all, data$stratum, sum)

data <- data %>%
  mutate(y64 = a014y + a1564y) %>%
  mutate(o64 = a6574y + a7584y + a85plusy)

# create uninform timeseries of means
data_time_serie = data %>%
  group_by(date) %>%
  summarise(
    mean_f_id = mean(f_id, na.rm = TRUE),
    mean_temp = mean(temp, na.rm = TRUE),
    mean_all = mean(all, na.rm = TRUE))

# moving averages for time series
data_time_serie$MA_f_id = rollmean(data_time_serie$mean_f_id, k = 30, fill = NA, align = "center")
data_time_serie$MA_all = rollmean(data_time_serie$mean_all, k = 30, fill = NA, align = "center")
data_time_serie$MA_temp = rollmean(data_time_serie$mean_temp, k = 30, fill = NA, align = "center")

# start dates of station records
start_dates = data.frame(station = as.vector(unique(data$station)),
                         date = rep("no",8))

for (i  in 1:8) {
  subs = data[data$station == as.character(unique(data$station)[i]),]
  start_dates$date[i] <- as.character(min(subs$date))
  
}
start_dates$date <- as.Date(start_dates$date)

# daily means
data_daily_mean = data %>%
  mutate(daymonth = format(date, "%m-%d")) %>%
  group_by(daymonth) %>%
  summarise(
    across(c(mal, fem, y64, o64, cvd, resp), mean),
    mean_f_id = mean(f_id),
    mean_temp = mean(temp),
    mean_all = mean(all),
    p50_f_id = quantile(f_id, 0.5),
    p95_f_id = quantile(f_id, 0.95),
    p75_f_id = quantile(f_id, 0.8),
    p90_f_id = quantile(f_id, 0.9),
    p25_temp = quantile(temp, 0.25),
    p50_temp = quantile(temp, 0.5),
    p75_temp = quantile(temp, 0.75),
    p25_all = quantile(all, 0.25),
    p50_all = quantile(all, 0.5),
    p75_all = quantile(all, 0.75),
  ) %>%
  mutate(daymonth = as.Date(paste0("2000-", daymonth)))

# moving averages of daily data
data_daily_mean$MA50 = rollmean(data_daily_mean$p50_f_id, k = 30, fill = NA, align = "center")
data_daily_mean$MA95 = rollmean(data_daily_mean$p95_f_id, k = 30, fill = NA, align = "center")
data_daily_mean$MA75 = rollmean(data_daily_mean$p75_f_id, k = 30, fill = NA, align = "center")
data_daily_mean$MA90 = rollmean(data_daily_mean$p90_f_id, k = 30, fill = NA, align = "center")

data_daily_mean$MA25_temp = rollmean(data_daily_mean$p25_temp, k = 30, fill = NA, align = "center")
data_daily_mean$MA50_temp = rollmean(data_daily_mean$p50_temp, k = 30, fill = NA, align = "center")
data_daily_mean$MA75_temp = rollmean(data_daily_mean$p75_temp, k = 30, fill = NA, align = "center")

data_daily_mean$MA25_all = rollmean(data_daily_mean$p25_all, k = 30, fill = NA, align = "center")
data_daily_mean$MA50_all = rollmean(data_daily_mean$p50_all, k = 30, fill = NA, align = "center")
data_daily_mean$MA75_all = rollmean(data_daily_mean$p75_all, k = 30, fill = NA, align = "center")

# ticks annual cycle x axis
monthly_ticks <- data_daily_mean$daymonth[!duplicated(format(data_daily_mean$daymonth, "%Y-%m"))]

# colors
colors <- viridis(3, option = "viridis")

```

<br>

This Markdown document presents some descriptive statistics about the key variables: foehn, temperature and hospitalizations. The focus lies on the distribution, the annual cycle and for hospitalizations the percentages of the subgroups.The shown data is generated by using the 8km buffer around the measurement stations.

<br>

#### distribution and annual cycle


```{r plot_foehn, echo=FALSE, fig.width= 10, fig.height=12}

par(mfrow=c(3,2), 
    mar = c(4,4,.5,1))


hist(data$f_id[data$f_id!=0], 
     breaks = 40,
     col = colors[2], 
     xlim = c(0,300),
     xlab = "daily foehn score", 
     main = "", 
     # cex.axis = 0.6,
     ylab = "frequency")
text(285, 2250, labels = "(a)", pos = 2)

plot(data_daily_mean$daymonth, 
     data_daily_mean$mean_f_id, 
     xaxt = "n", col = colors[2],
     type = "p",
     xlab = "month", 
     ylab = "daily foehn score", 
     main = "",
     ylim = c(0,140), 
     pch = 16, 
     # cex.axis = 0.6, 
     # lwd = 2,
     bty = "n")

axis(1, 
     at = monthly_ticks + 15, 
     labels = substr(format(monthly_ticks, "%b"),1,1)#,cex.axis = 0.6
     )

lines(data_daily_mean$daymonth, data_daily_mean$MA50, col = 1, lwd = 2, lty = 1)
lines(data_daily_mean$daymonth, data_daily_mean$MA75, col = 1, lwd = 2, lty = 2)
lines(data_daily_mean$daymonth, data_daily_mean$MA90, col = 1, lwd = 2, lty = 3)
# lines(data_daily_mean$daymonth, data_daily_mean$MA95, col = 5, lwd = 2, lty = 1)

legend(monthly_ticks[6]+15, 120,
       legend = c("p50", "p75","p90"), bty = "n",
       col = c(1,1,1),lwd = 1, lty = c(1,2,3), #cex = 0.7, 
       ncol = 4)

text(monthly_ticks[12], 135, 
     labels = "(b)", pos = 2)

hist(data$temp, 
     breaks = 30,
     col = colors[1], 
     # xlim = c(0,300),
     xlab = "daily mean temperature [\u00B0C]", 
     main = "", 
     # cex.axis = 0.6,
     ylab = "frequency")
text(28, 3950, labels = "(c)", pos = 2)

plot(data_daily_mean$daymonth, 
     data_daily_mean$mean_temp, 
     xaxt = "n", col = colors[1],
     type = "p",
     xlab = "month", 
     ylab = "daily mean temperature [\u00B0C]", 
     main = "",
     ylim = c(-5,25),
     pch = 16, 
     # cex.axis = 0.6, 
     bty = "n")

axis(1, 
     at = monthly_ticks + 15, 
     labels = substr(format(monthly_ticks, "%b"),1,1)#, cex.axis = 0.6
     )

lines(data_daily_mean$daymonth, data_daily_mean$MA25_temp, col = 1, lwd = 2, lty = 3)
lines(data_daily_mean$daymonth, data_daily_mean$MA50_temp, col = 1, lwd = 2, lty = 1)
lines(data_daily_mean$daymonth, data_daily_mean$MA75_temp, col = 1, lwd = 2, lty = 2)

legend(monthly_ticks[4]+15, 3,  
       legend = c("p25", "p50","p75"), bty = "n",
       col = c(1,1,1),lwd = 1, lty = c(3,1,2),# cex = 0.7, 
       ncol = 3)

text(monthly_ticks[12], 23, labels = "(d)", pos = 2)


hist(data$all, 
     breaks = 50,
     col = colors[3], 
     xlim = c(0,20),
     xlab = "daily all-cause hospitalizations", 
     main = "", 
     # cex.axis = 0.6,
     ylab = "frequency")
text(19, 21000, labels = "(e)", pos = 2)

plot(data_daily_mean$daymonth, 
     data_daily_mean$mean_all, 
     xaxt = "n", col = colors[3],
     type = "p",
     xlab = "month", 
     ylab = "daily all-cause hospitalizations", 
     main = "",
     ylim = c(0,6),
     pch = 16, 
     # cex.axis = 0.6, 
     bty = "n")

axis(1, 
     at = monthly_ticks + 15, 
     labels = substr(format(monthly_ticks, "%b"),1,1)#, cex.axis = 0.6
     )

lines(data_daily_mean$daymonth, data_daily_mean$MA25_all, col = 1, lwd = 2, lty = 3)
lines(data_daily_mean$daymonth, data_daily_mean$MA50_all, col = 1, lwd = 2, lty = 1)
lines(data_daily_mean$daymonth, data_daily_mean$MA75_all, col = 1, lwd = 2, lty = 2)

legend(monthly_ticks[4]+15, 5.75,  
       legend = c("p25", "p50","p75"), bty = "n",
       col = c(1,1,1),lwd = 1, lty = c(3,1,2), #cex = 0.7, 
       ncol = 3)

text(monthly_ticks[12], 5.4, labels = "(f)", pos = 2)
```

*Figure 1: (a) daily foehn score distribution excluding 0-foehn days, (b) daily mean foehn score with 30-day moving averages of the 50th, 75th, 90th percentile, (c) daily mean temperature distribution, (d) daily averages of daily mean temperature with 30-day moving averages of the 25th, 50th, 75th percentile, (e) daily all-cause hospitalization distribution, (f) daily mean all-cause hospitalizations with 30-day moving averages of the 25th, 50th, 75th percentile.*

<br>

#### time series

```{r timeseriesplot, echo=FALSE, fig.width= 10, fig.height=9}

# margins
par(mfrow = c(3, 1), 
    mar = c(0, 4, 0, 0.5),  # Top two plots have zero bottom margin
    oma = c(4, 0, 0, 0))      # Outer bottom margin for x-axis label

# foehn plot
plot(data_time_serie$date, data_time_serie$MA_f_id,
     type = "n",
     xlab = "",
     ylab = "daily foehn score",
     xaxt = "n"
     )

for(i in start_dates$date){  abline(v = i, col = 1, lty = 2)}

abline(v = as.Date("2008-01-01"), col = "brown1", lty = 1)

lines(data_time_serie$date, data_time_serie$MA_f_id,     
      lty = 1,
     lwd = 2,
     col = colors[2],)

text(data_time_serie$date[nrow(data_time_serie)], 78, labels = "(a)", pos = 2)

# temp plot
plot(data_time_serie$date, data_time_serie$MA_temp,
     type = "n",
     xlab = "",
     ylab = "daily mean temperature [\u00B0C]",
     xaxt = "n"
     )

for(i in start_dates$date){  abline(v = i, col = 1, lty = 2)}

abline(v = as.Date("2008-01-01"), col = "brown1", lty = 1)

lines(data_time_serie$date, data_time_serie$MA_temp,
      lty = 1,
     lwd = 2,
     col = colors[1],)

text(data_time_serie$date[nrow(data_time_serie)], -2, labels = "(b)", pos = 2)

# hosp plot
plot(data_time_serie$date, data_time_serie$MA_all,
     type = "n",
     xlab = "",
     ylab = "daily all-cause hospitalizations",
     )

mtext("time", side = 1, line = 2, outer = TRUE, cex = 0.8)

for(i in start_dates$date){  abline(v = i, col = 1, lty = 2)}

abline(v = as.Date("2008-01-01"), col = "brown1", lty = 1)

lines(data_time_serie$date, data_time_serie$MA_all,      
     lty = 1,
     lwd = 2,
     col = colors[3])

text(data_time_serie$date[nrow(data_time_serie)], 1.8, labels = "(c)", pos = 2)

text(start_dates$date[1]+20, 4.8, labels = "(1)", pos = 2)
text(start_dates$date[4]-20, 4.8, labels = "(3)", pos = 4)
text(start_dates$date[5]+20, 4.8, labels = "(2)", pos = 2)
text(start_dates$date[7]-20, 4.8, labels = "(5)", pos = 4)
text(start_dates$date[8]+20, 4.8, labels = "(4)", pos = 2)
text(as.Date("2008-01-01")+10, 5.2, labels = "(x)", pos = 4, col = "brown1")
  
```

*Figure 2: (a) 30-day moving average time series of mean daily foehn, (b) 30-day moving average time series of average daily mean temperature, (c) 30-day moving average of mean daily hospitalization. (1) start of data from Altdorf, Chur, Davos, Montana, (2) start of data from Magadino, (3) start of data from Lugano, (4) start of data from Visp, (5) start of data from Poschiavo. (x) redefinition of the MedStat regions by the Swiss Federal Office for Statistics.*

<br>

#### hospitalization table

*Table 1: General information about the whole data set and hospitalization characteristics based on annual sums.*


```{r gen_table, echo=FALSE}
data$station_year = paste0(data$station, data$year)

gen_stats = data.frame(years = NA,
                       stations = NA,
                       start_date = "",
                       end_date = "2019-12-31",
                       n_NA = NA,
                       hosp_annual_mean = NA,
                       hosp_annual_sd = NA)

# general stats
gen_stats$years = length(unique(data$station_year))
gen_stats$stations = length(unique(data$station))
gen_stats$start_date = paste0(min(data$date), "^")

# missing data
full_dates <- seq(min(data$date), max(data$date), by = "day")
missing_dates <- setdiff(full_dates, unique(data$date))
gen_stats$n_NA <- paste0( round((length(missing_dates) / length(full_dates)), digits = 4) * 100, "%")

# hospitalizations
# yearly mean data all
subs_y_all = data %>%
  group_by(station_year) %>%
  summarize(summe = sum(all, na.rm = TRUE)) 

gen_stats$hosp_annual_mean = mean(subs_y_all$summe, na.rm = TRUE)
gen_stats$hosp_annual_sd = sd(subs_y_all$summe, na.rm = TRUE)
gen_stats$max_hosp = max(subs_y_all$summe, na.rm = TRUE)
gen_stats$min_hosp = min(subs_y_all$summe, na.rm = TRUE)

kable(gen_stats, 
      digits = 2, 
      col.names = c("years [n]", "stations [n]", "start date", "end date", "missing days", "mean hosp", "sd of hosp", "max hosp", "min hosp")
      # 
)

```

*^ the datasets for multiple stations started after this date (see appendix or figure 2)*


#### weather table

*Table 2: Temperature statistics based on annual means and foehn statistics based on annual sums.*

```{r foehn stats, echo = FALSE}
weather_stats = data.frame(mean_temp = NA)

# yearly mean data all
subs_y_all = data %>%
  group_by(station_year) %>%
  summarize(mittel_temp = mean(temp, na.rm = TRUE),
            summe_foehn = sum(f_id, na.rm = TRUE)) 
  
# temperature stats
weather_stats$mean_temp = mean(subs_y_all$mittel_temp, na.rm = TRUE)
weather_stats$sd_temp = sd(subs_y_all$mittel_temp, na.rm = TRUE)
weather_stats$max_temp = max(subs_y_all$mittel_temp, na.rm = TRUE)
weather_stats$min_temp = min(subs_y_all$mittel_temp, na.rm = TRUE)

# foehn stats
weather_stats$mean_f = mean(subs_y_all$summe_foehn, na.rm = TRUE)
weather_stats$sd_f = sd(subs_y_all$summe_foehn, na.rm = TRUE)
weather_stats$max_f = max(subs_y_all$summe_foehn, na.rm = TRUE)
weather_stats$min_f = min(subs_y_all$summe_foehn, na.rm = TRUE)


kable(weather_stats, 
      digits = 2, 
      col.names = c("mean temp [째C]", "sd temp [째C]", "max temp [째C]", "min temp [째C]", "mean foehn", "sd foehn", "max foehn", "min foehn")
      # 
)



```


#### Appendix

*Table 3: General information per station and hospitalization characteristics per station based on annual sums.*

```{r gen_table_station, echo=FALSE}
stations = as.vector(unique(data$station)) 

gen_stats = data.frame(station = stations)

for (i in 1:length(stations)) {
  sta = stations[i]
  
  subs = data[data$station == sta,]
  
  subs_y_all = subs %>%
  group_by(year) %>%
  summarize(summe = sum(all, na.rm = TRUE)) 

  gen_stats$years[i] = length(unique(subs$year))
  gen_stats$start_date[i] = min(subs$date)
  
  # missing data
  full_dates <- seq(min(subs$date), max(subs$date), by = "day")
  missing_dates <- setdiff(full_dates, subs$date)
  gen_stats$n_NA[i] <- paste0( round((length(missing_dates) / length(full_dates)), digits = 4) * 100, "%")
  
  # hosp stats
  gen_stats$hosp_annual_mean[i] = mean(subs_y_all$summe, na.rm = TRUE)
  gen_stats$hosp_annual_sd[i] = sd(subs_y_all$summe, na.rm = TRUE)
  gen_stats$max_hosp[i] = max(subs_y_all$summe, na.rm = TRUE)
  gen_stats$min_hosp[i] = min(subs_y_all$summe, na.rm = TRUE) 
  
  
  
  
  }
# general stats

# missing data
full_dates <- seq(min(data$date), max(data$date), by = "day")
missing_dates <- setdiff(full_dates, unique(data$date))
gen_stats$n_NA <- paste0( round((length(missing_dates) / length(full_dates)), digits = 4) * 100, "%")

# hospitalizations
# yearly mean data all
subs_y_all = data %>%
  group_by(station_year) %>%
  summarize(summe = sum(all, na.rm = TRUE)) 

gen_stats$hosp_annual_mean = mean(subs_y_all$summe, na.rm = TRUE)
gen_stats$hosp_annual_sd = sd(subs_y_all$summe, na.rm = TRUE)
gen_stats$max_hosp = max(subs_y_all$summe, na.rm = TRUE)
gen_stats$min_hosp = min(subs_y_all$summe, na.rm = TRUE)

kable(gen_stats, 
      digits = 2, 
      col.names = c("years [n]", "stations [n]", "start date", "end date", "missing days", "mean hosp", "sd of hosp", "max hosp", "min hosp")
      # 
)

```



<br>

*Table 2: descriptive statistics for the yearly averages of temperature in general and per station.*


```{r temp stats3, echo = FALSE}
# per station and for all
temp_stats =  data.frame(yearly_average    = as.numeric(rep(NA,9)),
                          yearly_sd = as.numeric(rep(NA,9)),
                          maxi     = as.numeric(rep(NA,9)),
                          mini  = as.numeric(rep(NA,9)),
                          row.names = c("all", as.vector(unique(data$station))))



    # yearly mean data all
subs_y_all = data %>%
  group_by(station_year) %>%
  summarize(mittel = mean(temp, na.rm = TRUE),
            stand = sd(temp, na.rm = TRUE),
            summe = sum(temp, na.rm = TRUE)) 
  
temp_stats$yearly_average[1] = mean(subs_y_all$mittel, na.rm = TRUE)
temp_stats$yearly_sd[1]     = sd(subs_y_all$mittel, na.rm = TRUE)
temp_stats$maxi[1]          = max(subs_y_all$mittel, na.rm = TRUE)
temp_stats$mini[1]          = min(subs_y_all$mittel, na.rm = TRUE)
  
for(i in 1:8){

  # extract station
  subs = data[data$station == unique(data$station)[i],]

  subs_y = subs %>%
    mutate(year = as.Date(paste0(format(date, "%Y"), "-01-01"))) %>%  # Convert year to Date
    group_by(year) %>%
    summarize(mittel = mean(temp, na.rm = TRUE),
            stand = sd(temp, na.rm = TRUE),
            summe = sum(temp, na.rm = TRUE))
  
  temp_stats$yearly_average[i+1] = mean(subs_y$mittel, na.rm = TRUE)
  temp_stats$yearly_sd[i+1]      = sd(subs_y$mittel, na.rm = TRUE)
  temp_stats$maxi[i+1]          = max(subs_y$mittel, na.rm = TRUE)
  temp_stats$mini[i+1]          = min(subs_y$mittel, na.rm = TRUE)
  

}

kable(temp_stats, 
      digits = 2, 
      col.names = c("yearly mean", "yearly sd", "maximum", "minimum")
      # 
)


```


<br>



#### hospitalization table





```{r hosp stats3, echo = FALSE}
# per station and for all
hosp_stats =  data.frame(yearly_average    = as.numeric(rep(NA,9)),
                          yearly_sd = as.numeric(rep(NA,9)),
                          daily_average     = as.numeric(rep(NA,9)),
                          daily_sd  = as.numeric(rep(NA,9)),
                          perc_of_hosp = as.numeric(rep(NA,9)),
                          row.names = c("all", as.vector(unique(data$station))))



    # yearly mean data all
subs_y_all = data %>%
  group_by(station_year) %>%
  summarize(mittel = mean(all, na.rm = TRUE),
            stand = sd(all, na.rm = TRUE),
            summe = sum(all, na.rm = TRUE)) 
  
hosp_stats$yearly_average[1] = mean(subs_y_all$summe, na.rm = TRUE)
hosp_stats$yearly_sd[1]     = sd(subs_y_all$summe, na.rm = TRUE)
hosp_stats$daily_average[1] = mean(subs_y_all$mittel, na.rm = TRUE)
hosp_stats$daily_sd[1]      = sd(subs_y_all$mittel, na.rm = TRUE)
hosp_stats$perc_of_hosp[1]  = (sum(data$all) / sum(data$all)) *100
  
for(i in 1:8){

  # extract station
  subs = data[data$station == unique(data$station)[i],]

  subs_y = subs %>%
    mutate(year = as.Date(paste0(format(date, "%Y"), "-01-01"))) %>%  # Convert year to Date
    group_by(year) %>%
    summarize(mittel = mean(all, na.rm = TRUE),
            stand = sd(all, na.rm = TRUE),
            summe = sum(all, na.rm = TRUE))
  
  hosp_stats$yearly_average[i+1] = mean(subs_y$summe, na.rm = TRUE)
  hosp_stats$yearly_sd[i+1]     = sd(subs_y$summe, na.rm = TRUE)
  hosp_stats$daily_average[i+1] = mean(subs_y$mittel, na.rm = TRUE)
  hosp_stats$daily_sd[i+1]      = sd(subs_y$mittel, na.rm = TRUE)
  
  hosp_stats$perc_of_hosp[i+1] = ( sum(data$all[data$station == unique(data$station)[i]]) / sum(data$all) ) *100
    


}

kable(hosp_stats, 
      digits = 2, 
      col.names = c("yearly mean", "yearly sd", "daily mean", "daily sd", "hosp percentage")
      # 
)


```


```{r hosp stats 2, echo = FALSE}
# per station and for all
hosp_stats_2 =  data.frame(y64  = as.numeric(rep(NA,9)),
                         o64  = as.numeric(rep(NA,9)),
                         male  = as.numeric(rep(NA,9)),
                         fema = as.numeric(rep(NA,9)),
                         cvd  = as.numeric(rep(NA,9)),
                         resp  = as.numeric(rep(NA,9)),
                         uri  = as.numeric(rep(NA,9)),
                         inf  = as.numeric(rep(NA,9)),
                         ment = as.numeric(rep(NA,9)),
                        row.names = c("all", as.vector(unique(data$station))))


hosp_stats_2$y64[1] = sum(data$y64[data$y64 > 0]) / sum(data$all) *100
hosp_stats_2$o64[1] = sum(data$o64[data$o64 > 0]) / sum(data$all) *100
hosp_stats_2$male[1] = sum(data$mal[data$mal > 0]) / sum(data$all) *100
hosp_stats_2$fema[1] = sum(data$fem[data$fem > 0]) / sum(data$all) *100
hosp_stats_2$cvd[1] = sum(data$cvd[data$cvd > 0]) / sum(data$all) *100
hosp_stats_2$resp[1] = sum(data$resp[data$resp > 0]) / sum(data$all) *100
hosp_stats_2$uri[1] = sum(data$uri[data$uri > 0]) / sum(data$all) *100
hosp_stats_2$inf[1] = sum(data$inf[data$inf > 0]) / sum(data$all) *100
hosp_stats_2$ment[1] = sum(data$ment[data$ment > 0]) / sum(data$all) *100
  
for(i in 1:8){

  # extract station
  subs = data[data$station == unique(data$station)[i],]
  
  hosp_stats_2$y64[i+1] = sum(subs$y64[subs$y64 > 0]) / sum(subs$all)  *100
  hosp_stats_2$o64[i+1] = sum(subs$o64[subs$o64 > 0]) / sum(subs$all) *100
  hosp_stats_2$male[i+1] = sum(subs$mal[subs$mal > 0]) / sum(subs$all) *100 
  hosp_stats_2$fema[i+1] = sum(subs$fem[subs$fem > 0]) / sum(subs$all) *100
  hosp_stats_2$cvd[i+1] = sum(subs$cvd[subs$cvd > 0]) / sum(subs$all) *100
  hosp_stats_2$resp[i+1] = sum(subs$resp[subs$resp > 0]) / sum(subs$all) *100
  hosp_stats_2$uri[i+1] = sum(subs$uri[subs$uri > 0]) / sum(subs$all) *100
  hosp_stats_2$inf[i+1] = sum(subs$inf[subs$inf > 0]) / sum(subs$all) *100
  hosp_stats_2$ment[i+1] = sum(subs$ment[subs$ment > 0]) / sum(subs$all) *100



}

kable(hosp_stats_2, 
      digits = 2, 
      col.names = c("y64", "o64", "male", "female", "cvd", "resp", "uri", "inf", "ment")
      # 
)


```
 
<br>


*Table 1: Statistical information about the foehn data in general and per station.*

```{r foehn stats3, echo = FALSE}
# per station and for all
foehn_stats =  data.frame(yearly_average    = as.numeric(rep(NA,9)),
                          yearly_sd = as.numeric(rep(NA,9)),
                          daily_average     = as.numeric(rep(NA,9)),
                          daily_sd  = as.numeric(rep(NA,9)),
                          no_foehn_percentage = as.numeric(rep(NA,9)),
                          foehn_percentage = as.numeric(rep(NA,9)),
                          years = as.numeric(rep(NA,9)),
                          row.names = c("all", as.vector(unique(data$station))))


data$station_year = paste0(data$station, data$year)

    # yearly mean data all
subs_y_all = data %>%
  group_by(station_year) %>%
  summarize(mittel = mean(f_id, na.rm = TRUE),
            stand = sd(f_id, na.rm = TRUE),
            summe = sum(f_id, na.rm = TRUE)) 
  
foehn_stats$yearly_average[1] = mean(subs_y_all$summe, na.rm = TRUE)
foehn_stats$yearly_sd[1]      = sd(subs_y_all$summe, na.rm = TRUE)
foehn_stats$daily_average[1]  = mean(subs_y_all$mittel, na.rm = TRUE)
foehn_stats$daily_sd[1]       = sd(subs_y_all$mittel, na.rm = TRUE)
foehn_stats$years[1]          = length(unique(data$station_year)) 
foehn_stats$foehn_percentage[1] = (sum(data$f_id) / sum(data$f_id)) *100
  
foehn_stats$no_foehn_percentage[1] = round( (length(which(data$f_id == 0)) / nrow(data))*100, digits = 1)


for(i in 1:8){

  # extract station
  subs = data[data$station == unique(data$station)[i],]

  # yearly mean data
  subs_y = subs %>%
    mutate(year = as.Date(paste0(format(date, "%Y"), "-01-01"))) %>%  # Convert year to Date
    group_by(year) %>%
    summarize(mittel = mean(f_id, na.rm = TRUE),
              stand = sd(f_id, na.rm = TRUE),
              summe = sum(f_id, na.rm = TRUE)) 
  
    # daily mean data
  subs_d = subs %>%
    mutate(day = as.Date(paste0("2000-",format(date, "%m-%d")))) %>%  # Convert year to Date
    group_by(day) %>%
    summarize(mittel = mean(f_id, na.rm = TRUE),
              stand = sd(f_id, na.rm = TRUE),
              summe = sum(f_id, na.rm = TRUE)) 
  
  foehn_stats$yearly_average[i+1] = mean(subs_y$summe, na.rm = TRUE)
  foehn_stats$yearly_sd[i+1]      = sd(subs_y$summe, na.rm = TRUE)
  foehn_stats$daily_average[i+1]  = mean(subs_d$mittel, na.rm = TRUE)
  foehn_stats$daily_sd[i+1]       = sd(subs_d$mittel, na.rm = TRUE)
  
  foehn_stats$foehn_percentage[i+1] = (sum(data$f_id[data$station == unique(data$station)[i]]) / sum(data$f_id)) *100
  
  foehn_stats$no_foehn_percentage[i+1] = round( (length(which(data$f_id[data$station == unique(data$station)[i]]== 0)) / nrow(data[data$station == unique(data$station)[i],]) )*100, digits = 1)
  
  foehn_stats$years[i+1]          = length(unique(subs$station_year))

}

kable(foehn_stats, 
      digits = 2, 
      col.names = c("yearly average", "yearly sd", "daily average", "daily sd", "percentage no-foehn", "percentage foehn score", "years [n]")
      # 
)


```



*Figure 2: daily mean temperature distribution of the whole temperature series (left) and the average of the daily mean temperature for every day (right).*

<br>

*Table 2: descriptive statistics for the yearly averages of temperature in general and per station.*


```{r temp stats5, echo = FALSE}
# per station and for all
temp_stats =  data.frame(yearly_average    = as.numeric(rep(NA,9)),
                          yearly_sd = as.numeric(rep(NA,9)),
                          maxi     = as.numeric(rep(NA,9)),
                          mini  = as.numeric(rep(NA,9)),
                          row.names = c("all", as.vector(unique(data$station))))



    # yearly mean data all
subs_y_all = data %>%
  group_by(station_year) %>%
  summarize(mittel = mean(temp, na.rm = TRUE),
            stand = sd(temp, na.rm = TRUE),
            summe = sum(temp, na.rm = TRUE)) 
  
temp_stats$yearly_average[1] = mean(subs_y_all$mittel, na.rm = TRUE)
temp_stats$yearly_sd[1]     = sd(subs_y_all$mittel, na.rm = TRUE)
temp_stats$maxi[1]          = max(subs_y_all$mittel, na.rm = TRUE)
temp_stats$mini[1]          = min(subs_y_all$mittel, na.rm = TRUE)
  
for(i in 1:8){

  # extract station
  subs = data[data$station == unique(data$station)[i],]

  subs_y = subs %>%
    mutate(year = as.Date(paste0(format(date, "%Y"), "-01-01"))) %>%  # Convert year to Date
    group_by(year) %>%
    summarize(mittel = mean(temp, na.rm = TRUE),
            stand = sd(temp, na.rm = TRUE),
            summe = sum(temp, na.rm = TRUE))
  
  temp_stats$yearly_average[i+1] = mean(subs_y$mittel, na.rm = TRUE)
  temp_stats$yearly_sd[i+1]      = sd(subs_y$mittel, na.rm = TRUE)
  temp_stats$maxi[i+1]          = max(subs_y$mittel, na.rm = TRUE)
  temp_stats$mini[i+1]          = min(subs_y$mittel, na.rm = TRUE)
  

}

kable(temp_stats, 
      digits = 2, 
      col.names = c("yearly mean", "yearly sd", "maximum", "minimum")
      # 
)


```


<br>



#### hospitalization table





```{r hosp stats7, echo = FALSE}
# per station and for all
hosp_stats =  data.frame(yearly_average    = as.numeric(rep(NA,9)),
                          yearly_sd = as.numeric(rep(NA,9)),
                          daily_average     = as.numeric(rep(NA,9)),
                          daily_sd  = as.numeric(rep(NA,9)),
                          perc_of_hosp = as.numeric(rep(NA,9)),
                          row.names = c("all", as.vector(unique(data$station))))



    # yearly mean data all
subs_y_all = data %>%
  group_by(station_year) %>%
  summarize(mittel = mean(all, na.rm = TRUE),
            stand = sd(all, na.rm = TRUE),
            summe = sum(all, na.rm = TRUE)) 
  
hosp_stats$yearly_average[1] = mean(subs_y_all$summe, na.rm = TRUE)
hosp_stats$yearly_sd[1]     = sd(subs_y_all$summe, na.rm = TRUE)
hosp_stats$daily_average[1] = mean(subs_y_all$mittel, na.rm = TRUE)
hosp_stats$daily_sd[1]      = sd(subs_y_all$mittel, na.rm = TRUE)
hosp_stats$perc_of_hosp[1]  = (sum(data$all) / sum(data$all)) *100
  
for(i in 1:8){

  # extract station
  subs = data[data$station == unique(data$station)[i],]

  subs_y = subs %>%
    mutate(year = as.Date(paste0(format(date, "%Y"), "-01-01"))) %>%  # Convert year to Date
    group_by(year) %>%
    summarize(mittel = mean(all, na.rm = TRUE),
            stand = sd(all, na.rm = TRUE),
            summe = sum(all, na.rm = TRUE))
  
  hosp_stats$yearly_average[i+1] = mean(subs_y$summe, na.rm = TRUE)
  hosp_stats$yearly_sd[i+1]     = sd(subs_y$summe, na.rm = TRUE)
  hosp_stats$daily_average[i+1] = mean(subs_y$mittel, na.rm = TRUE)
  hosp_stats$daily_sd[i+1]      = sd(subs_y$mittel, na.rm = TRUE)
  
  hosp_stats$perc_of_hosp[i+1] = ( sum(data$all[data$station == unique(data$station)[i]]) / sum(data$all) ) *100
    


}

kable(hosp_stats, 
      digits = 2, 
      col.names = c("yearly mean", "yearly sd", "daily mean", "daily sd", "hosp percentage")
      # 
)


```


```{r hosp stats 26, echo = FALSE}
# per station and for all
hosp_stats_2 =  data.frame(y64  = as.numeric(rep(NA,9)),
                         o64  = as.numeric(rep(NA,9)),
                         male  = as.numeric(rep(NA,9)),
                         fema = as.numeric(rep(NA,9)),
                         cvd  = as.numeric(rep(NA,9)),
                         resp  = as.numeric(rep(NA,9)),
                         uri  = as.numeric(rep(NA,9)),
                         inf  = as.numeric(rep(NA,9)),
                         ment = as.numeric(rep(NA,9)),
                        row.names = c("all", as.vector(unique(data$station))))


hosp_stats_2$y64[1] = sum(data$y64[data$y64 > 0]) / sum(data$all) *100
hosp_stats_2$o64[1] = sum(data$o64[data$o64 > 0]) / sum(data$all) *100
hosp_stats_2$male[1] = sum(data$mal[data$mal > 0]) / sum(data$all) *100
hosp_stats_2$fema[1] = sum(data$fem[data$fem > 0]) / sum(data$all) *100
hosp_stats_2$cvd[1] = sum(data$cvd[data$cvd > 0]) / sum(data$all) *100
hosp_stats_2$resp[1] = sum(data$resp[data$resp > 0]) / sum(data$all) *100
hosp_stats_2$uri[1] = sum(data$uri[data$uri > 0]) / sum(data$all) *100
hosp_stats_2$inf[1] = sum(data$inf[data$inf > 0]) / sum(data$all) *100
hosp_stats_2$ment[1] = sum(data$ment[data$ment > 0]) / sum(data$all) *100
  
for(i in 1:8){

  # extract station
  subs = data[data$station == unique(data$station)[i],]
  
  hosp_stats_2$y64[i+1] = sum(subs$y64[subs$y64 > 0]) / sum(subs$all)  *100
  hosp_stats_2$o64[i+1] = sum(subs$o64[subs$o64 > 0]) / sum(subs$all) *100
  hosp_stats_2$male[i+1] = sum(subs$mal[subs$mal > 0]) / sum(subs$all) *100 
  hosp_stats_2$fema[i+1] = sum(subs$fem[subs$fem > 0]) / sum(subs$all) *100
  hosp_stats_2$cvd[i+1] = sum(subs$cvd[subs$cvd > 0]) / sum(subs$all) *100
  hosp_stats_2$resp[i+1] = sum(subs$resp[subs$resp > 0]) / sum(subs$all) *100
  hosp_stats_2$uri[i+1] = sum(subs$uri[subs$uri > 0]) / sum(subs$all) *100
  hosp_stats_2$inf[i+1] = sum(subs$inf[subs$inf > 0]) / sum(subs$all) *100
  hosp_stats_2$ment[i+1] = sum(subs$ment[subs$ment > 0]) / sum(subs$all) *100



}

kable(hosp_stats_2, 
      digits = 2, 
      col.names = c("y64", "o64", "male", "female", "cvd", "resp", "uri", "inf", "ment")
      # 
)


```
 
<br>


#### appendix
