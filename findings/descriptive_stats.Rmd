---
title: "descriptive statisitcs: figures and tables"
author: "Tino Schneidewind"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<br>

This Markdown document presents some descriptive statistics about the key variables: foehn, temperature and hospitalizations. The focus lies on the distribution, the annual cycle and for hospitalizations the percentages of the subgroups.The shown data is generated by using the 8km buffer around the measurement stations.

<br>

#### foehn statistics

Excluding all days without foehn, we can see that the frequency of the daily foehn score descreases with the daily foehn score quite linearly after an exponential decline between 0 and 50 foehn score (daily foehn score distribution). However, the maximum daily achievable foehn score of 288 peaks and has a frequency comparable to scores lower than 50.

The relatively stationary distance between the moving average of the percentiles suggest a similar but shifted average distribution over the annual cycle (daily average foehn score). Foehn events are strongest in spring, followed by late autumn. Foehn is on average the least intense in summer and slightly more intense in winter. Median foehn daily foehn score is year round 0, while mean foehn reaches values up to 70 in spring. The mean values follow the 80th percentile moving average closer than the median moving average, further indicating a very skewed distribution.



```{r data, echo=FALSE, warning=FALSE, message=FALSE}
## Preamble ####
rm(list=ls())

# packages
library(dplyr); library(tidyr); library(plotly);library(zoo); library(viridis); library(knitr)

data = read.csv("C:/Users/tinos/Documents/Master - Climate Science/3 - Master Thesis/data/MedStat_aggregated/centroid_aggregated/hosp_buffer_8000.csv") # data

data$date = as.Date(data$date); data$station <- as.factor(data$station)

# index to include only stratum that have hosp counts
data$stratum_dow = as.factor(data$stratum_dow); data$stratum = as.factor(data$stratum)
ind_dow = tapply(data$all, data$stratum_dow, sum); ind = tapply(data$all, data$stratum, sum)

data <- data %>%
  mutate(y64 = a014y + a1564y) %>%
  mutate(o64 = a6574y + a7584y + a85plusy)

# daily means
data_daily_mean = data %>%
  mutate(daymonth = format(date, "%m-%d")) %>%
  group_by(daymonth) %>%
  summarise(
    across(c(all, mal, fem, y64, o64, cvd, resp, temp), mean),
    mean_f_id = mean(f_id),
    p50_f_id = quantile(f_id, 0.5),
    p95_f_id = quantile(f_id, 0.95),
    p80_f_id = quantile(f_id, 0.8),
    p90_f_id = quantile(f_id, 0.9),
  ) %>%
  mutate(daymonth = as.Date(paste0("2000-", daymonth)))

data_daily_mean$MA50 = rollmean(data_daily_mean$p50_f_id, k = 30, fill = NA, align = "center")
data_daily_mean$MA95 = rollmean(data_daily_mean$p95_f_id, k = 30, fill = NA, align = "center")
data_daily_mean$MA80 = rollmean(data_daily_mean$p80_f_id, k = 30, fill = NA, align = "center")
data_daily_mean$MA90 = rollmean(data_daily_mean$p90_f_id, k = 30, fill = NA, align = "center")

monthly_ticks <- data_daily_mean$daymonth[!duplicated(format(data_daily_mean$daymonth, "%Y-%m"))]

```


```{r plot_foehn, echo=FALSE, fig.width= 10, fig.height=8}
par(mfrow=c(2,2))
hist(data$f_id[data$f_id!=0], 
     breaks = 150, 
     col = rgb(1,.1,.1,0.6), 
     xlim = c(0,300),
     xlab = "daily mean foehn score (excluding 0 foehn days)", 
     main = "daily foehn score distribution", 
     cex.axis = 0.6,
     ylab = "frequency")

plot(data_daily_mean$daymonth, 
     data_daily_mean$mean_f_id, 
     xaxt = "n", col = rgb(.1, .1, .1, alpha = 0.4),
     type = "p",
     xlab = "month", 
     ylab = "daily foehn score", 
     main = "daily average foehn score",
     ylim = c(0,220), 
     pch = 20, 
     cex.axis = 0.6, 
     bty = "n")

axis(1, 
     at = monthly_ticks + 15, 
     labels = substr(format(monthly_ticks, "%b"),1,1),
     cex.axis = 0.6)

lines(data_daily_mean$daymonth, data_daily_mean$MA50, col = 2, lwd = 2, lty = 1)
lines(data_daily_mean$daymonth, data_daily_mean$MA80, col = 4, lwd = 2, lty = 1)
lines(data_daily_mean$daymonth, data_daily_mean$MA90, col = 3, lwd = 2, lty = 1)
lines(data_daily_mean$daymonth, data_daily_mean$MA95, col = 5, lwd = 2, lty = 1)

legend(monthly_ticks[6], 193,  
       legend = c("p50", "p80","p90","p95"), bty = "n",
       col = c(2,4,3,5),lwd = 1, lty = 1, cex = 0.7, ncol = 4)

text(monthly_ticks[12], 200, labels = "30-day moving averages of percentiles", cex = 0.7, pos = 2)




```

```{r foehn stats, echo = FALSE}
foehn_stats =  data.frame(f_mean_yearly    = as.numeric(rep(NA,1)),
                   f_mean_yearly_sd = as.numeric(rep(NA,1)),
                   f_mean_daily     = as.numeric(rep(NA,1)),
                   f_mean_daily_sd  = as.numeric(rep(NA,1)),
                   f_0s             = as.numeric(rep(NA,1)))

```


